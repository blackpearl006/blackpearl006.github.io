<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*tGpisK1VFOLY8U6K85lyIA.png"></figure> <p>In this blog i will take you through processing fMRI data and make your fMRI data ready to be used in your analysis. We will use FSL’s FEAT tool for achieving the required results. Take a look at the below video to know how we obtain MRI scans.</p> <iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FRb_mdzgw-Jc%3Ffeature%3Doembed&amp;display_name=YouTube&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DRb_mdzgw-Jc&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FRb_mdzgw-Jc%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube" width="854" height="480" frameborder="0" scrolling="no"><a href="https://medium.com/media/111137b1079ea49d511d0bee03cdc0a5/href" rel="external nofollow noopener" target="_blank">https://medium.com/media/111137b1079ea49d511d0bee03cdc0a5/href</a></iframe> <p>There are mainly 2 types of fMRI, <strong>task fMRI</strong> and <strong>Resting state fMRI, </strong>the first open corresponds to when the subject is performing some task like breathing, tapping fingers inside the scanner and the latter corresponds to the subject being still and trying not to fall asleep inside the scanner. Both of them have a very different set of analysis to perform and we’ll go through preprocessing both of the fMRI data types. fMRI is intrinsically more noisier so we will need more tools for the preprocessing</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Y6vndsvKeTUMJLmvyg5hdA.png"></figure> <p>Click the <a href="https://medium.com/@daminininad/mri-preprocessing-using-fsl-383a67e7185" rel="external nofollow noopener" target="_blank">link</a> to reach my tutorial on processing structural MRI</p> <h4>fMRI data</h4> <p>For this blog we will use the fMRI data of a CN (cognitively normal) subject from ADNI dataset, you can access the data , here : github link ,<br>I have changed the file structure of the data for ease of programming</p> <h4>Conversion</h4> <p>The data that ADNI provides is in .dcm format and FEAT working only with 4D NIFTI (3D+time) and it’s recommended that the images be brain extracted.</p> <p>Utilize tools like dcm2niix for conversion of .dcm to .nifti</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/960/1*3scPZQ2V3dzEsFU3VvvJ-A.gif"><figcaption>Visualize the data using fsleyes</figcaption></figure> <h4>Brain extraction</h4> <p>you can see there are non brain material in the above gif for better analysis we would like them to be removed,, if we use bet tool on a 4D image then it will take only the first 3D MRI image and return only one brain extracted MRI image.<br>So we break the fMRI data into structural MRI image for each point in the timestamp and then perform brain extraction and then again put them together to achieve brain</p> <pre>#Extract individual volumes (timepoints) from the 4D dataset<br>fslsplit 002_S_4262_1.nii volumes -t<br><br>#Perform brain extraction on each volume separately<br>for volume in volumes*.nii.gz; do<br>  base_name=$(basename "$volume" .nii.gz)<br>  bet "$volume" "brain_extracted_$base_name"<br>done<br><br>#Merge the brain-extracted volumes back into a 4D dataset<br>fslmerge -t out_brain_extracted.nii.gz brain_extracted_*.nii.gz<br><br>#delete all the intermediate files<br>rm -r brain_extracted*.nii.gz volumes*.nii.gz</pre> <figure><img alt="" src="https://cdn-images-1.medium.com/max/960/1*gzi_pja_twTBAC7GqQaDfA.gif"><figcaption>brain extracted fMRI</figcaption></figure> <h3>Resting state fMRI</h3> <p><strong>Fact:</strong> the energy consumption of the various parts of the brains, brains has ~2% body weight but ~20% energy consumption.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/709/1*O3LS5PjdqTzyW0XAGgMTeA.jpeg"></figure> <figure><img alt="" src="https://cdn-images-1.medium.com/max/334/1*pvPUtAhcZN3HWY8zsV1ddw.png"><figcaption>(left)fMRI scan showing regions of the default mode network; this network shows more activity at rest. (right) Resting state fMRI of 2 young individuals with no cognitive deficit but one has genetic risk factor for alzheimer’s disease</figcaption></figure> <p>In task fMRI analysis, we know what to expect / look for ,, ie. there will be some noticeable changes in intensity and we model that using probability distributions or Gaussian linear models, but in Resting State fMRI we don’t know what to expect and there adds noise in every step of the process, and these noise can dominate in the signal we are interested in thus dominate our final results</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*le-v4x9527b4aGbuhmjXDQ.png"><figcaption>Probable causes for noise in fMRI data</figcaption></figure> <h3>Analysis of resting-state fMRI</h3> <p>Using FSLeyes visualize the high-res anatomical T1w images and it’s corresponding fMRI image</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*NpH3CP1Vw_wBeo7t"><figcaption>Visualizing structural MRI file inside anat folder</figcaption></figure> <p>Perform brain extraction on the high-res image</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*J9uCX5q8UUy-6HYX"><figcaption>Output from bet brain extraction tool:<br>Blue overlay is the brain extracted part f = 0.2</figcaption></figure> <p>The FEATtool is used to preprocess the fMRI, the below demo directs you what to choose the options as before you run the preprocessing. Specifically, this demo shows you how to upload the data into the preprocessing setup tool.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/960/0*HwDTV5inqV28SRI3"><figcaption>Uploading 4D fMRI data</figcaption></figure> <p>Snippet of the Pre-stats tab in the FEAT toolbox</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*PWpod-GjSU6B4sJ-"></figure> <p>Demo on what slice time correction means and how it affects the analysis.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/854/0*O8aICDKEI2X6lrxK"><figcaption>Most MRI scanners use interleaved MRI slice acquisitionFSL’s default is to <strong>not</strong> do slice-timing correction, and to include a <strong>temporal derivative</strong> instead</figcaption></figure> <p>Options to select on the registration tab</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/960/0*QXTx99bUp1Moe-0o"></figure> <p>Click Go and you will start the analysis, <br>Below is the summary of the analysis performed by the FEAT tool</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/960/0*orGChohYTfNzXGsu"></figure> <p>Visualize the output preprocessed fMRI data saved as filtered_func_data.nii.gz</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/960/0*0XQ3vg5mz-hdLFv3"></figure> <p>Refrences</p> <ol><li>Andy’s Brain Book : <a href="https://andysbrainbook.readthedocs.io/en/latest/fMRI_Short_Course/fMRI_01_DataDownload.html" rel="external nofollow noopener" target="_blank">https://andysbrainbook.readthedocs.io/en/latest/fMRI_Short_Course/fMRI_01_DataDownload.html</a> </li></ol> <p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=89668e78b11b" width="1" height="1" alt=""></p> </body></html>